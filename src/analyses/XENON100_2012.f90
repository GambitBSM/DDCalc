MODULE XENON100_2012

!=======================================================================
! XENON100 2012 ANALYSIS ROUTINES
! Based upon the XENON100 2012 analysis [1207.5988].  Two events seen in
! the analysis region.
!=======================================================================

USE DDTypes
USE DDDetectors

IMPLICIT NONE

CONTAINS


!-----------------------------------------------------------------------
! Initializes a DetectorStruct to the XENON100 2012 analysis.
! 
! The efficiencies used here were generated using TPCMC.
! 
! Required input arguments:
!     intervals   Indicates if sub-intervals should be included
! 
FUNCTION XENON100_2012_Init(intervals) RESULT(D)

  IMPLICIT NONE
  TYPE(DetectorStruct) :: D
  LOGICAL, INTENT(IN) :: intervals
  INTEGER, PARAMETER :: NE = 151
  INTEGER, PARAMETER :: NBINS = 3
  ! Efficiency curves energy tabulation points
  REAL*8, PARAMETER :: E(NE)                                            &
      =       (/ 0.10000d0, 0.10471d0, 0.10965d0, 0.11482d0, 0.12023d0, &
      0.12589d0, 0.13183d0, 0.13804d0, 0.14454d0, 0.15136d0, 0.15849d0, &
      0.16596d0, 0.17378d0, 0.18197d0, 0.19055d0, 0.19953d0, 0.20893d0, &
      0.21878d0, 0.22909d0, 0.23988d0, 0.25119d0, 0.26303d0, 0.27542d0, &
      0.28840d0, 0.30200d0, 0.31623d0, 0.33113d0, 0.34674d0, 0.36308d0, &
      0.38019d0, 0.39811d0, 0.41687d0, 0.43652d0, 0.45709d0, 0.47863d0, &
      0.50119d0, 0.52481d0, 0.54954d0, 0.57544d0, 0.60256d0, 0.63096d0, &
      0.66069d0, 0.69183d0, 0.72444d0, 0.75858d0, 0.79433d0, 0.83176d0, &
      0.87096d0, 0.91201d0, 0.95499d0, 1.0000d0,  1.0471d0,  1.0965d0,  &
      1.1482d0,  1.2023d0,  1.2589d0,  1.3183d0,  1.3804d0,  1.4454d0,  &
      1.5136d0,  1.5849d0,  1.6596d0,  1.7378d0,  1.8197d0,  1.9055d0,  &
      1.9953d0,  2.0893d0,  2.1878d0,  2.2909d0,  2.3988d0,  2.5119d0,  &
      2.6303d0,  2.7542d0,  2.8840d0,  3.0200d0,  3.1623d0,  3.3113d0,  &
      3.4674d0,  3.6308d0,  3.8019d0,  3.9811d0,  4.1687d0,  4.3652d0,  &
      4.5709d0,  4.7863d0,  5.0119d0,  5.2481d0,  5.4954d0,  5.7544d0,  &
      6.0256d0,  6.3096d0,  6.6069d0,  6.9183d0,  7.2444d0,  7.5858d0,  &
      7.9433d0,  8.3176d0,  8.7096d0,  9.1201d0,  9.5499d0, 10.000d0,   &
     10.471d0,  10.965d0,  11.482d0,  12.023d0,  12.589d0,  13.183d0,   &
     13.804d0,  14.454d0,  15.136d0,  15.849d0,  16.596d0,  17.378d0,   &
     18.197d0,  19.055d0,  19.953d0,  20.893d0,  21.878d0,  22.909d0,   &
     23.988d0,  25.119d0,  26.303d0,  27.542d0,  28.840d0,  30.200d0,   &
     31.623d0,  33.113d0,  34.674d0,  36.308d0,  38.019d0,  39.811d0,   &
     41.687d0,  43.652d0,  45.709d0,  47.863d0,  50.119d0,  52.481d0,   &
     54.954d0,  57.544d0,  60.256d0,  63.096d0,  66.069d0,  69.183d0,   &
     72.444d0,  75.858d0,  79.433d0,  83.176d0,  87.096d0,  91.201d0,   &
     95.499d0, 100.00d0 /)
  ! Efficiency (total)
  REAL*8, PARAMETER :: EFF0(NE)                                         &
      =       (/ 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      4.00000d-6,1.00000d-6,4.00000d-6,2.00000d-6,5.00000d-6,1.20000d-5,&
      1.00000d-5,1.40000d-5,2.60000d-5,3.60000d-5,3.50000d-5,7.60000d-5,&
      8.70000d-5,1.16000d-4,1.76000d-4,2.20000d-4,3.49000d-4,4.83000d-4,&
      7.35000d-4,9.10000d-4,1.33200d-3,1.65400d-3,2.34300d-3,2.92200d-3,&
      4.00500d-3,5.06900d-3,6.38100d-3,7.86100d-3,9.81400d-3,1.27250d-2,&
      1.56120d-2,1.92370d-2,2.36900d-2,2.82510d-2,3.36450d-2,4.02370d-2,&
      4.66420d-2,5.47130d-2,6.41220d-2,7.29530d-2,8.46030d-2,9.60320d-2,&
      1.09300d-1,1.23320d-1,1.39660d-1,1.55620d-1,1.74690d-1,1.94520d-1,&
      2.16200d-1,2.38030d-1,2.61850d-1,2.85090d-1,3.09390d-1,3.29750d-1,&
      3.52810d-1,3.70130d-1,3.84230d-1,3.95210d-1,4.00710d-1,4.03610d-1,&
      4.01040d-1,3.94630d-1,3.84650d-1,3.72750d-1,3.59150d-1,3.43050d-1,&
      3.27380d-1,3.13490d-1,2.98190d-1,2.83900d-1,2.72670d-1,2.60230d-1,&
      2.50270d-1,2.39970d-1,2.30500d-1,2.21070d-1,2.10540d-1,1.98930d-1,&
      1.86480d-1,1.70950d-1,1.53000d-1,1.32510d-1,1.09770d-1,8.64570d-2,&
      6.48630d-2,4.59830d-2,3.03230d-2,1.85540d-2,1.06490d-2,5.61100d-3,&
      2.66100d-3,1.22700d-3,5.37000d-4,2.15000d-4,7.20000d-5,2.70000d-5,&
      6.00000d-6,5.00000d-6,2.00000d-6,0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0 /)
  ! Efficiency (first interval)
  REAL*8, PARAMETER :: EFF1(NE)                                         &
      =       (/ 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      4.00000d-6,1.00000d-6,2.00000d-6,2.00000d-6,2.00000d-6,7.00000d-6,&
      7.00000d-6,1.20000d-5,1.80000d-5,1.90000d-5,1.80000d-5,4.50000d-5,&
      5.00000d-5,6.60000d-5,9.90000d-5,1.31000d-4,2.04000d-4,2.62000d-4,&
      3.86000d-4,4.72000d-4,6.91000d-4,8.25000d-4,1.12100d-3,1.32800d-3,&
      1.81300d-3,2.17300d-3,2.63700d-3,3.16700d-3,4.01900d-3,5.00000d-3,&
      5.84600d-3,7.08400d-3,8.07700d-3,9.52700d-3,1.07220d-2,1.22500d-2,&
      1.38680d-2,1.54030d-2,1.73800d-2,1.91490d-2,2.11010d-2,2.34970d-2,&
      2.55000d-2,2.75090d-2,2.98440d-2,3.21020d-2,3.46350d-2,3.63250d-2,&
      3.87330d-2,3.98790d-2,4.15350d-2,4.20320d-2,4.20200d-2,4.11880d-2,&
      3.96450d-2,3.72390d-2,3.35650d-2,2.97950d-2,2.55980d-2,2.09740d-2,&
      1.67220d-2,1.26450d-2,9.26300d-3,6.46100d-3,4.18800d-3,2.65400d-3,&
      1.49700d-3,9.08000d-4,4.94000d-4,2.52000d-4,1.15000d-4,5.30000d-5,&
      1.80000d-5,1.00000d-5,3.00000d-6,2.00000d-6,0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0 /)
  ! Efficiency (second interval)
  REAL*8, PARAMETER :: EFF2(NE)                                         &
     =        (/ 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 2.00000d-6,0.00000d0, 3.00000d-6,5.00000d-6,&
      2.00000d-6,2.00000d-6,7.00000d-6,1.60000d-5,1.30000d-5,2.40000d-5,&
      2.70000d-5,4.40000d-5,6.60000d-5,7.10000d-5,1.23000d-4,1.81000d-4,&
      2.80000d-4,3.18000d-4,4.81000d-4,6.01000d-4,8.92000d-4,1.12500d-3,&
      1.57100d-3,1.97900d-3,2.53400d-3,3.11900d-3,3.76600d-3,4.85500d-3,&
      5.99400d-3,7.26200d-3,8.97600d-3,1.06020d-2,1.24910d-2,1.47470d-2,&
      1.67300d-2,1.92640d-2,2.21710d-2,2.49040d-2,2.81090d-2,3.10880d-2,&
      3.45400d-2,3.84720d-2,4.16550d-2,4.56960d-2,4.96820d-2,5.38700d-2,&
      5.85350d-2,6.20200d-2,6.60030d-2,6.81040d-2,7.06770d-2,7.07810d-2,&
      7.09020d-2,6.90490d-2,6.44180d-2,5.90480d-2,5.28870d-2,4.62860d-2,&
      3.85470d-2,3.06790d-2,2.35860d-2,1.74240d-2,1.25220d-2,8.14600d-3,&
      5.31700d-3,3.32900d-3,1.80300d-3,1.01000d-3,5.14000d-4,2.38000d-4,&
      1.05000d-4,5.40000d-5,1.80000d-5,7.00000d-6,3.00000d-6,0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0 /)
  ! Efficiency (third interval)
  REAL*8, PARAMETER :: EFF3(NE)                                         &
      =       (/ 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      1.00000d-6,0.00000d0, 1.00000d-6,1.00000d-6,4.00000d-6,7.00000d-6,&
      1.00000d-5,6.00000d-6,1.10000d-5,1.80000d-5,2.20000d-5,4.00000d-5,&
      6.90000d-5,1.20000d-4,1.60000d-4,2.28000d-4,3.30000d-4,4.69000d-4,&
      6.21000d-4,9.17000d-4,1.21000d-3,1.57500d-3,2.02900d-3,2.87000d-3,&
      3.77200d-3,4.89100d-3,6.63700d-3,8.12200d-3,1.04320d-2,1.32400d-2,&
      1.60440d-2,2.00460d-2,2.45710d-2,2.89000d-2,3.53930d-2,4.14470d-2,&
      4.92590d-2,5.73430d-2,6.81650d-2,7.78210d-2,9.03720d-2,1.04320d-1,&
      1.18930d-1,1.36130d-1,1.54310d-1,1.74960d-1,1.96690d-1,2.17780d-1,&
      2.42270d-1,2.63840d-1,2.86240d-1,3.06370d-1,3.22220d-1,3.36350d-1,&
      3.45770d-1,3.51300d-1,3.51800d-1,3.48860d-1,3.42440d-1,3.32250d-1,&
      3.20570d-1,3.09260d-1,2.95900d-1,2.82640d-1,2.72040d-1,2.59930d-1,&
      2.50150d-1,2.39910d-1,2.30480d-1,2.21060d-1,2.10540d-1,1.98930d-1,&
      1.86480d-1,1.70950d-1,1.53000d-1,1.32510d-1,1.09770d-1,8.64570d-2,&
      6.48630d-2,4.59830d-2,3.03230d-2,1.85540d-2,1.06490d-2,5.61100d-3,&
      2.66100d-3,1.22700d-3,5.37000d-4,2.15000d-4,7.20000d-5,2.70000d-5,&
      6.00000d-6,5.00000d-6,2.00000d-6,0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, 0.00000d0, &
      0.00000d0, 0.00000d0 /)
  ! Efficiencies array (2D)
  REAL*8, PARAMETER :: EFF(NE,0:NBINS)                                   &
      = RESHAPE( (/ EFF0(:), EFF1(:), EFF2(:), EFF3(:) /),SHAPE(EFF))

  ! One call for all settings.
  ! Most of these _must_ be there to ensure everything get initialized.
  CALL SetDetector(D,mass=34d0,time=224.6d0,Nevents_tot=2,              &
                   Backgr_tot=1.0d0,Nelem=1,Zelem=(/54/),               &
                   NE=NE,E=E,Nbins=NBINS,eff_all=EFF,                   &
                   intervals=intervals)
  D%eff_file = '[XENON100 2012]'
  
END FUNCTION


! C++ interface wrapper
INTEGER(KIND=C_INT) FUNCTION C_XENON100_2012_Init(intervals) &
 BIND(C,NAME='C_DDCalc_xenon100_2012_init') 
  USE ISO_C_BINDING, only: C_BOOL, C_INT
  IMPLICIT NONE
  LOGICAL(KIND=C_BOOL), INTENT(IN) :: intervals
  N_Detectors = N_Detectors + 1
  ALLOCATE(Detectors(N_Detectors)%p)
  Detectors(N_Detectors)%p = XENON100_2012_Init(LOGICAL(intervals))
  C_XENON100_2012_Init = N_Detectors
END FUNCTION


END MODULE
